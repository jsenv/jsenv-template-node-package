# import map

An importmap file is part of this codebase to make ESLint and VSCode capable to resolve imports.

Node.js is resolving import with a complex algorithm called [esm resolution algorithm](https://nodejs.org/dist/latest-v16.x/docs/api/esm.html#esm_resolution_algorithm). There is currently no ESLint plugin and no VSCode extension implementing this algorithm.

Thanks to the importmap file, ESLint and VSCode are capable to resolve imports like Node.js.

If you want to keep that check [How to use importmap](#how-to-use-importmap). Otherwise see [How to remove importmap](#how-to-remove-importmap).

# How to use importmap

The importmap file is generated by [script/generate-import-map/generate-import-map.js](../../script/generate-import-map/generate-import-map.js).

This script is executed after every `npm install` thanks to `"posinstall"` script in [package.json](../../package.json#L55).

To sum up you should regenerate the importmap file everytime you update your `package.json` to keep it in sync. When importmap and package.json are not in sync:

1. For some import, ESLint will complain they cannot be resolved.

2. For these import, vscode won't find the corresponding file meaning:

   - no autocompletion for imports from that file
   - cannot use `go to definition` on variables coming from that file (`cmd+click` won't work)

# How to remove importmap

**Warning**: ESLint and VSCode need this to properly resolve imports as [explained above](#import-map)

If you want to remove importmap from this repository, follow the steps below.

1. Remove `"node ./script/transform-package/remove-postinstall.js && "` from `"prepublishOnly"` in [package.json](../../package.json#L56)
2. Remove `"postpublish"` from `"scripts"` in [package.json](../../package.json#L57)
3. Remove `"postinstall"` from `"scripts"` in [package.json](../../package.json#L55)
4. Remove `"generate-import-map"` from `"scripts"` in [package.json](../../package.json#L47)
5. Delete [script/generate-import-map/](../../script/generate-import-map/) directory
6. Replace `"import/resolver"` in [.eslintrc.cjs](../../.eslintrc.cjs#L45)

   ```diff
   - "@jsenv/importmap-eslint-resolver": {
   -   projectDirectoryUrl: __dirname,
   -   importMapFileRelativeUrl: "./importmap.dev.importmap",
   -   node: true,
   - },
   + "node": {}
   ```

7. Remove `"@jsenv/importmap-eslint-resolver"` from `"devDependencies"` in [package.json](../../package.json#L68)
8. Remove `/importmap.dev.importmap` in [.gitignore](../../.gitignore#L23)
9. Delete `./importmap.dev.importmap` file
10. Remove `"paths"` from `./jsconfig.json` file
